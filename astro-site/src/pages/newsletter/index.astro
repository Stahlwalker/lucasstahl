---
import Layout from '../../layouts/Layout.astro';
---

<Layout
	title="The Marketing Builder Newsletter - Luke Stahl"
	description="A monthly selection of web dev articles, noteworthy projects, opportunities in dev marketing, individuals to follow, and insights on effective marketing strategies."
	canonicalUrl="https://lukestahl.io/newsletter/"
	ogTitle="The Marketing Builder Newsletter"
	ogDescription="Monthly updates on web development, developer marketing, and the intersection of code and marketing."
	showAnnouncement={false}
>
	<div class="newsletter-page">
		<!-- Animated background elements -->
		<div class="newsletter-background">
			<div class="bg-shape shape-1"></div>
			<div class="bg-shape shape-2"></div>
			<div class="bg-shape shape-3"></div>
			<div class="bg-grid"></div>
		</div>

		<div class="newsletter-container">
			<div class="newsletter-content">
				<p class="newsletter-label">NEWSLETTER</p>
				<h1 class="newsletter-title">
					<span class="code-bracket">&lt;</span>
					The Marketing Builder
					<span class="code-bracket">/&gt;</span>
				</h1>
				<p class="newsletter-message">
					A monthly selection of web dev articles, noteworthy projects, opportunities in dev marketing, individuals to follow, and insights on effective marketing strategies.
				</p>
			</div>

			<form class="newsletter-form" action="/newsletter/confirmed" method="POST">
				<div class="form-row">
					<div class="form-field">
						<label for="firstName" class="form-label">
							<span class="label-icon"><i class="fa-solid fa-user"></i></span>
							First Name
						</label>
						<input
							type="text"
							id="firstName"
							name="firstName"
							class="form-input"
							required
							placeholder="John"
						/>
					</div>

					<div class="form-field">
						<label for="lastName" class="form-label">
							<span class="label-icon"><i class="fa-solid fa-user"></i></span>
							Last Name
						</label>
						<input
							type="text"
							id="lastName"
							name="lastName"
							class="form-input"
							required
							placeholder="Doe"
						/>
					</div>
				</div>

				<div class="form-field">
					<label for="email" class="form-label">
						<span class="label-icon"><i class="fa-solid fa-at"></i></span>
						Email Address
					</label>
					<input
						type="email"
						id="email"
						name="email"
						class="form-input"
						required
						placeholder="john@example.com"
					/>
				</div>

				<div style="text-align: center;">
					<button type="submit" class="newsletter-button">
						<i class="fa-solid fa-envelope"></i>
						Subscribe
					</button>
				</div>
			</form>
		</div>
	</div>
</Layout>

<style>
	.newsletter-page {
		min-height: calc(100vh - 200px);
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 4rem 2rem;
		position: relative;
		overflow: hidden;
	}

	/* Animated Background */
	.newsletter-background {
		position: absolute;
		inset: 0;
		z-index: 0;
		opacity: 0.4;
		pointer-events: none;
	}

	.bg-shape {
		position: absolute;
		border-radius: 50%;
		filter: blur(60px);
		animation: float 20s ease-in-out infinite;
	}

	.bg-shape.shape-1 {
		width: 400px;
		height: 400px;
		background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(59, 130, 246, 0.2));
		top: -100px;
		left: -100px;
		animation-delay: 0s;
	}

	.bg-shape.shape-2 {
		width: 350px;
		height: 350px;
		background: linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(96, 165, 250, 0.3));
		bottom: -80px;
		right: -80px;
		animation-delay: 7s;
	}

	.bg-shape.shape-3 {
		width: 300px;
		height: 300px;
		background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3));
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		animation-delay: 14s;
	}

	.bg-grid {
		position: absolute;
		inset: 0;
		background-image:
			linear-gradient(rgba(96, 165, 250, 0.05) 1px, transparent 1px),
			linear-gradient(90deg, rgba(96, 165, 250, 0.05) 1px, transparent 1px);
		background-size: 50px 50px;
		opacity: 0.3;
	}

	@keyframes float {
		0%, 100% {
			transform: translate(0, 0) scale(1);
		}
		33% {
			transform: translate(30px, -30px) scale(1.1);
		}
		66% {
			transform: translate(-20px, 20px) scale(0.9);
		}
	}

	/* Container */
	.newsletter-container {
		max-width: 580px;
		width: 100%;
		position: relative;
		z-index: 1;
		animation: fadeInUp 0.8s ease-out;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Content */
	.newsletter-content {
		text-align: center;
		margin-bottom: 3rem;
		padding-top: 2rem;
	}

	.newsletter-label {
		font-family: 'Fira Code', monospace;
		font-size: 0.75rem;
		font-weight: 600;
		color: var(--text-secondary);
		letter-spacing: 2px;
		text-transform: uppercase;
		margin: 0 0 0.75rem 0;
	}

	.newsletter-title {
		font-family: 'Fira Code', monospace;
		font-size: 2rem;
		font-weight: 600;
		color: var(--text-primary);
		margin: 0 0 1.5rem 0;
		line-height: 1.2;
	}

	.newsletter-message {
		font-size: 1.125rem;
		color: var(--text-secondary);
		margin: 0;
		line-height: 1.7;
		max-width: 500px;
		margin: 0 auto;
	}

	/* Form */
	.newsletter-form {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		background: var(--bg-secondary);
		padding: 2.5rem;
		border-radius: 16px;
		border: 1px solid rgba(96, 165, 250, 0.15);
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
		transition: all 0.3s ease;
	}

	.newsletter-form:hover {
		border-color: rgba(96, 165, 250, 0.3);
		box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
	}

	.form-row {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1rem;
	}

	.form-field {
		display: flex;
		flex-direction: column;
		gap: 0.625rem;
	}

	.form-label {
		font-size: 0.875rem;
		font-weight: 600;
		color: var(--text-primary);
		display: flex;
		align-items: center;
		gap: 0.5rem;
		letter-spacing: 0.01em;
	}

	.label-icon {
		color: var(--accent-color);
		opacity: 0.7;
		font-size: 0.75rem;
	}

	.form-input {
		padding: 1rem 1.125rem;
		background: var(--bg-primary);
		border: 2px solid rgba(96, 165, 250, 0.2);
		border-radius: 10px;
		color: var(--text-primary);
		font-size: 1rem;
		font-family: inherit;
		transition: all 0.25s ease;
		width: 100%;
	}

	.form-input::placeholder {
		color: var(--text-secondary);
		opacity: 0.5;
	}

	.form-input:focus {
		outline: none;
		border-color: var(--accent-color);
		background: var(--bg-primary);
		box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.1);
		transform: translateY(-1px);
	}

	.form-input:hover:not(:focus) {
		border-color: rgba(96, 165, 250, 0.4);
	}

	/* Button */
	.newsletter-button {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		margin-top: 0.5rem;
		padding: 0.5rem 1rem;
		background-color: rgba(34, 211, 238, 0.15);
		border: 1px solid rgba(34, 211, 238, 0.5);
		border-radius: 6px;
		color: #22d3ee;
		text-decoration: none;
		font-family: 'Inter', sans-serif;
		font-size: 0.8rem;
		font-weight: 500;
		transition: all 0.3s ease;
		cursor: pointer;
	}

	.newsletter-button:hover {
		background-color: rgba(34, 211, 238, 0.25);
		border-color: #22d3ee;
		color: #22d3ee;
		text-decoration: none;
		transform: translateY(-2px);
		box-shadow: 0 0 10px rgba(34, 211, 238, 0.3);
	}

	.newsletter-button i {
		font-size: 0.85rem;
	}

	.newsletter-button:focus {
		outline: 2px solid #22d3ee;
		outline-offset: 2px;
	}

	/* Light mode button */
	:global([data-theme="light"]) .newsletter-button {
		background-color: rgba(14, 165, 233, 0.1);
		border: 1.5px solid rgba(14, 165, 233, 0.4);
		color: #075985;
	}

	:global([data-theme="light"]) .newsletter-button:hover {
		background-color: rgba(14, 165, 233, 0.15);
		border-color: #075985;
		color: #075985;
		box-shadow: 0 0 10px rgba(14, 165, 233, 0.2);
	}

	/* Mobile Responsive */
	@media (max-width: 768px) {
		.newsletter-page {
			min-height: calc(100vh - 250px);
			padding: 2rem 1rem;
		}

		.newsletter-label {
			font-size: 0.7rem;
		}

		.newsletter-title {
			font-size: 1.625rem;
		}

		.newsletter-message {
			font-size: 1rem;
		}

		.newsletter-form {
			padding: 2rem 1.5rem;
		}

		.form-row {
			grid-template-columns: 1fr;
		}

		.newsletter-button {
			font-size: 0.75rem;
			padding: 0.45rem 0.9rem;
		}

		.bg-shape {
			filter: blur(40px);
		}

		.bg-shape.shape-1,
		.bg-shape.shape-2 {
			width: 250px;
			height: 250px;
		}

		.bg-shape.shape-3 {
			width: 200px;
			height: 200px;
		}
	}

	@media (max-width: 480px) {
		.newsletter-label {
			font-size: 0.65rem;
		}

		.newsletter-title {
			font-size: 1.375rem;
		}

		.newsletter-message {
			font-size: 0.9375rem;
		}

		.newsletter-form {
			padding: 1.5rem 1.25rem;
		}

		.form-input {
			padding: 0.875rem 1rem;
			font-size: 0.9375rem;
		}

		.newsletter-button {
			padding: 0.45rem 0.9rem;
			font-size: 0.75rem;
		}
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const form = document.querySelector('.newsletter-form');

		// Create message div if it doesn't exist
		let messageDiv = document.getElementById('subscribe-message');
		if (!messageDiv) {
			messageDiv = document.createElement('div');
			messageDiv.id = 'subscribe-message';
			messageDiv.style.cssText = `
				margin-top: 1rem;
				padding: 1rem;
				border-radius: 8px;
				text-align: center;
				font-size: 0.95rem;
				display: none;
			`;
			form.appendChild(messageDiv);
		}

		form.addEventListener('submit', async (e) => {
			e.preventDefault();

			const firstName = document.getElementById('firstName').value.trim();
			const lastName = document.getElementById('lastName').value.trim();
			const email = document.getElementById('email').value.trim();
			const fullName = `${firstName} ${lastName}`;

			const submitButton = form.querySelector('button[type="submit"]');
			const originalButtonText = submitButton.innerHTML;

			// Disable button and show loading state
			submitButton.disabled = true;
			submitButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Subscribing...';

			// Hide any previous messages
			messageDiv.style.display = 'none';

			try {
				const response = await fetch('https://marketing-builder-api.onrender.com/api/subscribers/subscribe', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						name: fullName,
						email: email
					})
				});

				const data = await response.json();

				if (response.ok) {
					// Success
					messageDiv.textContent = 'âœ“ Check your email to confirm your subscription!';
					messageDiv.style.cssText += `
						display: block;
						background: rgba(34, 197, 94, 0.1);
						border: 2px solid rgba(34, 197, 94, 0.3);
						color: rgb(34, 197, 94);
					`;
					form.reset();

					// Track with PostHog if available
					if (window.posthog) {
						window.posthog.capture('newsletter_subscribed', {
							email: email,
							source: 'newsletter_page'
						});
					}
				} else {
					// Error from API
					messageDiv.textContent = data.error || 'Something went wrong. Please try again.';
					messageDiv.style.cssText += `
						display: block;
						background: rgba(239, 68, 68, 0.1);
						border: 2px solid rgba(239, 68, 68, 0.3);
						color: rgb(239, 68, 68);
					`;
				}
			} catch (error) {
				// Network error
				messageDiv.textContent = 'Failed to subscribe. Please check your connection and try again.';
				messageDiv.style.cssText += `
					display: block;
					background: rgba(239, 68, 68, 0.1);
					border: 2px solid rgba(239, 68, 68, 0.3);
					color: rgb(239, 68, 68);
				`;
			} finally {
				// Re-enable button
				submitButton.disabled = false;
				submitButton.innerHTML = originalButtonText;
			}
		});
	});
</script>
