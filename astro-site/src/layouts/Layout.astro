---
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import PostHog from '../components/posthog.astro';
import DevMarketingConsole from '../components/DevMarketingConsole.astro';
import Search from '../components/Search.astro';
import AnnouncementBar from '../components/AnnouncementBar.astro';

interface Props {
	title: string;
	description?: string;
	ogTitle?: string;
	ogDescription?: string;
	ogImage?: string;
	canonicalUrl?: string;
	additionalCss?: string[];
	hideHandbookButton?: boolean;
	// Announcement Bar Configuration
	showAnnouncement?: boolean;
	announcementMessage?: string;
	announcementLink?: string;
	announcementId?: string;
}

const {
	title,
	description = "The portfolio of Luke Stahl — showcasing work across developer marketing, product strategy, and modern web development.",
	ogTitle = "Luke Stahl - Developer Marketer & Web Developer",
	ogDescription = "Developer marketer and web developer with a passion for building and optimizing for the web, bridging the gap between marketing strategy and technical implementation.",
	ogImage = "https://lukestahl.io/assets/images/Hero_OG.png",
	canonicalUrl = "https://lukestahl.io",
	additionalCss = [],
	hideHandbookButton = false,
	// Announcement Bar (easily toggle on/off)
	showAnnouncement = true,
	announcementMessage = "New: Markdown + AI Website vs CMS",
	announcementLink = "/blog/markdown-vs-cms/",
	announcementId = "blog-markdown-cms-dec-2025"
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
	<!-- PostHog Analytics -->
	<PostHog />

	<!-- https -->
	<script type="text/javascript">
		var host = "lukestahl.io";
		if ((host == window.location.host) && (window.location.protocol != "https:"))
			window.location.protocol = "https";
	</script>

	<meta charset="UTF-8">
	<meta name="description" content={description}>
	<link rel="canonical" href={canonicalUrl} />
	<link rel="alternate" type="application/rss+xml" title="Luke Stahl's Blog" href="https://lukestahl.io/rss.xml" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>{title}</title>

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content={canonicalUrl}>
	<meta property="og:title" content={ogTitle}>
	<meta property="og:description" content={ogDescription}>
	<meta property="og:image" content={ogImage}>
	<meta property="og:image:width" content="1200">
	<meta property="og:image:height" content="630">

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:url" content={canonicalUrl}>
	<meta name="twitter:title" content={ogTitle}>
	<meta name="twitter:description" content={ogDescription}>
	<meta name="twitter:image" content={ogImage}>

	<!-- JSON-LD Structured Data - Person Schema -->
	<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "Person",
			"name": "Luke Stahl",
			"url": "https://lukestahl.io",
			"image": "https://lukestahl.io/assets/images/Luke_Stahl_Headshot.jpg",
			"jobTitle": "Developer Marketer",
			"description": "Developer marketer and frontend developer who bridges the gap between marketing strategy and technical execution",
			"sameAs": [
				"https://github.com/Stahlwalker",
				"https://www.linkedin.com/in/lucasstahl/"
			],
			"knowsAbout": [
				"Developer Marketing",
				"Frontend Development",
				"React",
				"Next.js",
				"Astro",
				"Content Strategy",
				"SEO",
				"Web Development"
			]
		}
	</script>

	<link href="/LS.ico" rel="icon">

	<!-- Preconnect to external origins for faster resource loading -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="preconnect" href="https://cdnjs.cloudflare.com">
	<link rel="preconnect" href="https://us-i.posthog.com">
	<link rel="preconnect" href="https://maxcdn.bootstrapcdn.com">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/dark-mode.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/search.css">

	{additionalCss.map(css => (
		<link rel="stylesheet" type="text/css" href={css}>
	))}

	<!-- Async load fonts to prevent render blocking -->
	<link href="https://fonts.googleapis.com/css?family=Share+Tech&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
	<link href="https://fonts.googleapis.com/css?family=Gruppo&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
	<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

	<!-- Noscript fallback for fonts -->
	<noscript>
		<link href="https://fonts.googleapis.com/css?family=Share+Tech&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Gruppo&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	</noscript>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/LS.ico" />
	<link rel="apple-touch-icon" href="/LS.ico" />
	<meta name="application-name" content="LukeStahl" />
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://lukestahl.io/LS.ico" />

	<!-- Theme Script (runs immediately to prevent flash) -->
	<script is:inline>
		// Initialize theme before page renders to prevent flash
		(function() {
			const savedMode = localStorage.getItem('theme');
			let theme;

			if (savedMode === 'dark' || savedMode === 'light') {
				// User has manually set dark or light
				theme = savedMode;
			} else {
				// System mode or no preference - check system preference
				const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
				theme = prefersDark ? 'dark' : 'light';
			}

			document.documentElement.setAttribute('data-theme', theme);

			// Set background color immediately to prevent white flash
			const backgroundColor = theme === 'dark' ? '#0a0e27' : '#f8fafc';
			document.documentElement.style.backgroundColor = backgroundColor;
		})();
	</script>

	<!-- Eliminate white flash on page navigation -->
	<style is:global>
		html {
			background-color: #0a0e27; /* Dark mode default */
		}

		html[data-theme="light"] {
			background-color: #f8fafc !important;
		}

		body {
			background-color: transparent;
		}
	</style>
</head>
<body>
	{showAnnouncement && announcementMessage && (
		<AnnouncementBar
			message={announcementMessage}
			link={announcementLink}
			announcementId={announcementId}
		/>
	)}
	<Navbar />
	<slot />
	<Footer />
	{!hideHandbookButton && <DevMarketingConsole />}
	<Search />

	<!-- Theme Toggle Functionality -->
	<script is:inline>
		document.addEventListener('DOMContentLoaded', function() {
			const themeToggle = document.getElementById('themeToggle');
			const themeToggleMobile = document.getElementById('themeToggleMobile');
			const footerThemeToggle = document.getElementById('footerThemeToggle');
			const themeIcon = document.getElementById('themeIcon');
			const themeIconMobile = document.getElementById('themeIconMobile');
			const html = document.documentElement;

			// Get current theme mode (dark, light, or system)
			function getCurrentMode() {
				return localStorage.getItem('theme') || 'system';
			}

			// Get the actual theme to display (resolves system to dark/light)
			function getDisplayTheme() {
				const mode = getCurrentMode();
				if (mode === 'system') {
					return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
				}
				return mode;
			}

			// Update footer toggle UI
			function updateFooterToggle() {
				if (!footerThemeToggle) return;

				const mode = getCurrentMode();
				const buttons = footerThemeToggle.querySelectorAll('.theme-option');
				const highlight = footerThemeToggle.querySelector('.theme-toggle-highlight');

				buttons.forEach((btn, index) => {
					if (btn.getAttribute('data-theme') === mode) {
						btn.classList.add('active');
						// Position highlight
						if (highlight) {
							if (index === 0) {
								highlight.style.left = '2px';
								highlight.style.width = '32px';
							} else if (index === 1) {
								highlight.style.left = '34px';
								highlight.style.width = '32px';
							} else {
								highlight.style.left = '66px';
								highlight.style.width = 'calc(100% - 68px)';
							}
						}
					} else {
						btn.classList.remove('active');
					}
				});
			}

			// Update icon based on current mode
			function updateIcon() {
				const mode = getCurrentMode();
				let icon;

				if (mode === 'dark') {
					icon = 'fa-moon';
				} else if (mode === 'light') {
					icon = 'fa-sun';
				} else {
					icon = 'fa-display'; // system mode
				}

				if (themeIcon) {
					themeIcon.className = `fa-solid ${icon}`;
				}
				if (themeIconMobile) {
					themeIconMobile.className = `fa-solid ${icon}`;
				}
			}

			// Send theme to iframe
			function sendThemeToIframe(theme) {
				const iframe = document.querySelector('.assistant-iframe');
				if (iframe && iframe.contentWindow) {
					iframe.contentWindow.postMessage({ type: 'theme-change', theme }, '*');
				}
			}

			// Apply theme to document
			function applyTheme() {
				const displayTheme = getDisplayTheme();
				html.setAttribute('data-theme', displayTheme);
				// Send theme to iframe
				sendThemeToIframe(displayTheme);
			}

			// Toggle theme: dark -> light -> system -> dark
			function toggleTheme() {
				const currentMode = getCurrentMode();
				let newMode;

				if (currentMode === 'dark') {
					newMode = 'light';
				} else if (currentMode === 'light') {
					newMode = 'system';
				} else {
					newMode = 'dark';
				}

				localStorage.setItem('theme', newMode);
				applyTheme();
				updateIcon();
				updateFooterToggle();
			}

			// Set specific theme (for footer toggle)
			function setTheme(newMode) {
				localStorage.setItem('theme', newMode);
				applyTheme();
				updateIcon();
				updateFooterToggle();
			}

			// Set up event listeners
			if (themeToggle) {
				themeToggle.addEventListener('click', toggleTheme);
			}
			if (themeToggleMobile) {
				themeToggleMobile.addEventListener('click', toggleTheme);
			}

			// Set up footer toggle listeners
			if (footerThemeToggle) {
				const buttons = footerThemeToggle.querySelectorAll('.theme-option');
				buttons.forEach(btn => {
					btn.addEventListener('click', (e) => {
						e.stopPropagation();
						const mode = btn.getAttribute('data-theme');
						setTheme(mode);
					});
				});
			}

			// Listen for system theme changes when in system mode
			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
				if (getCurrentMode() === 'system') {
					applyTheme();
					updateFooterToggle();
				}
			});

			// Initialize
			applyTheme();
			updateIcon();
			updateFooterToggle();
		});
	</script>

	<!-- Cursor Spotlight Glow Effect -->
	<div id="cursor-glow" aria-hidden="true"></div>

	<style>
		#cursor-glow {
			position: fixed;
			width: 100px;
			height: 100px;
			border-radius: 50%;
			pointer-events: none;
			z-index: 9999;
			opacity: 0;
			background: radial-gradient(
				circle,
				rgba(96, 165, 250, 0.3) 0%,
				rgba(96, 165, 250, 0.15) 40%,
				transparent 70%
			);
			transform: translate(-50%, -50%);
			mix-blend-mode: screen;
			transition: opacity 0.3s ease;
			left: 0;
			top: 0;
		}

		/* Light mode - more subtle glow */
		:global([data-theme="light"]) #cursor-glow {
			background: radial-gradient(
				circle,
				rgba(37, 99, 235, 0.2) 0%,
				rgba(37, 99, 235, 0.1) 40%,
				transparent 70%
			);
		}

		/* Hide on touch devices */
		@media (hover: none) {
			#cursor-glow {
				display: none;
			}
		}
	</style>

	<script>
		import { animate } from 'motion';

		// Only run on desktop (non-touch devices)
		if (window.matchMedia('(hover: hover)').matches) {
			const cursorGlow = document.getElementById('cursor-glow');

			if (cursorGlow) {
				let mouseX = 0;
				let mouseY = 0;

				// Track mouse position
				document.addEventListener('mousemove', (e) => {
					mouseX = e.clientX;
					mouseY = e.clientY;

					// Show glow on first move
					if (cursorGlow.style.opacity === '0' || cursorGlow.style.opacity === '') {
						cursorGlow.style.opacity = '1';
					}

					// Animate glow position with smooth easing
					animate(
						cursorGlow,
						{
							left: mouseX + 'px',
							top: mouseY + 'px'
						},
						{
							duration: 0.2,
							easing: 'ease-out'
						}
					);
				});

				// Hide glow when cursor leaves window
				document.addEventListener('mouseleave', () => {
					cursorGlow.style.opacity = '0';
				});

				// Show glow when cursor enters window
				document.addEventListener('mouseenter', () => {
					cursorGlow.style.opacity = '1';
				});
			}
		}
	</script>

	<!-- Console Easter Egg -->
	<script is:inline>
		console.log("Hello. Appreciate you being here. — Luke");
	</script>
</body>
</html>
