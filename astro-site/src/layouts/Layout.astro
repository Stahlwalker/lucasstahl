---
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import PostHog from '../components/posthog.astro';
import DevMarketingConsole from '../components/DevMarketingConsole.astro';
import Search from '../components/Search.astro';

interface Props {
	title: string;
	description?: string;
	ogTitle?: string;
	ogDescription?: string;
	ogImage?: string;
	canonicalUrl?: string;
	additionalCss?: string[];
	hideHandbookButton?: boolean;
}

const {
	title,
	description = "The portfolio of Luke Stahl — showcasing work across developer marketing, product strategy, and modern web development.",
	ogTitle = "Luke Stahl - Developer Marketer & Web Developer",
	ogDescription = "Developer marketer and web developer with a passion for building and optimizing for the web, bridging the gap between marketing strategy and technical implementation.",
	ogImage = "https://lucasstahl.com/assets/images/Hero_OG.png",
	canonicalUrl = "https://lucasstahl.com",
	additionalCss = [],
	hideHandbookButton = false
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
	<!-- PostHog Analytics -->
	<PostHog />

	<!-- https -->
	<script type="text/javascript">
		var host = "lucasstahl.com";
		if ((host == window.location.host) && (window.location.protocol != "https:"))
			window.location.protocol = "https";
	</script>

	<meta charset="UTF-8">
	<meta name="description" content={description}>
	<link rel="canonical" href={canonicalUrl} />
	<link rel="alternate" type="application/rss+xml" title="Luke Stahl's Blog" href="https://lucasstahl.com/rss.xml" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>{title}</title>

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content={canonicalUrl}>
	<meta property="og:title" content={ogTitle}>
	<meta property="og:description" content={ogDescription}>
	<meta property="og:image" content={ogImage}>
	<meta property="og:image:width" content="1200">
	<meta property="og:image:height" content="630">

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:url" content={canonicalUrl}>
	<meta name="twitter:title" content={ogTitle}>
	<meta name="twitter:description" content={ogDescription}>
	<meta name="twitter:image" content={ogImage}>

	<!-- JSON-LD Structured Data - Person Schema -->
	<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "Person",
			"name": "Luke Stahl",
			"url": "https://lucasstahl.com",
			"image": "https://lucasstahl.com/assets/images/Luke_Stahl_Headshot.jpg",
			"jobTitle": "Developer Marketer",
			"description": "Developer marketer and frontend developer who bridges the gap between marketing strategy and technical execution",
			"sameAs": [
				"https://github.com/Stahlwalker",
				"https://www.linkedin.com/in/lucasstahl/"
			],
			"knowsAbout": [
				"Developer Marketing",
				"Frontend Development",
				"React",
				"Next.js",
				"Astro",
				"Content Strategy",
				"SEO",
				"Web Development"
			]
		}
	</script>

	<link href="/LS.ico" rel="icon">

	<!-- Preconnect to external origins for faster resource loading -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="preconnect" href="https://cdnjs.cloudflare.com">
	<link rel="preconnect" href="https://us-i.posthog.com">
	<link rel="preconnect" href="https://maxcdn.bootstrapcdn.com">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/dark-mode.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/search.css">

	{additionalCss.map(css => (
		<link rel="stylesheet" type="text/css" href={css}>
	))}

	<link href="https://fonts.googleapis.com/css?family=Share+Tech&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Gruppo&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

	<!-- favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/LS.ico" />
	<link rel="apple-touch-icon" href="/LS.ico" />
	<meta name="application-name" content="LucasStahl" />
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://lucasstahl.com/LS.ico" />

	<!-- Theme Script (runs immediately to prevent flash) -->
	<script is:inline>
		// Initialize theme before page renders to prevent flash
		(function() {
			const savedMode = localStorage.getItem('theme');
			let theme;

			if (savedMode === 'dark' || savedMode === 'light') {
				// User has manually set dark or light
				theme = savedMode;
			} else {
				// System mode or no preference - check system preference
				const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
				theme = prefersDark ? 'dark' : 'light';
			}

			document.documentElement.setAttribute('data-theme', theme);
		})();
	</script>
</head>
<body>
	<Navbar />
	<slot />
	<Footer />
	{!hideHandbookButton && <DevMarketingConsole />}
	<Search />

	<!-- Theme Toggle Functionality -->
	<script is:inline>
		document.addEventListener('DOMContentLoaded', function() {
			const themeToggle = document.getElementById('themeToggle');
			const themeToggleMobile = document.getElementById('themeToggleMobile');
			const footerThemeToggle = document.getElementById('footerThemeToggle');
			const themeIcon = document.getElementById('themeIcon');
			const themeIconMobile = document.getElementById('themeIconMobile');
			const html = document.documentElement;

			// Get current theme mode (dark, light, or system)
			function getCurrentMode() {
				return localStorage.getItem('theme') || 'system';
			}

			// Get the actual theme to display (resolves system to dark/light)
			function getDisplayTheme() {
				const mode = getCurrentMode();
				if (mode === 'system') {
					return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
				}
				return mode;
			}

			// Update footer toggle UI
			function updateFooterToggle() {
				if (!footerThemeToggle) return;

				const mode = getCurrentMode();
				const buttons = footerThemeToggle.querySelectorAll('.theme-option');
				const highlight = footerThemeToggle.querySelector('.theme-toggle-highlight');

				buttons.forEach((btn, index) => {
					if (btn.getAttribute('data-theme') === mode) {
						btn.classList.add('active');
						// Position highlight
						if (highlight) {
							if (index === 0) {
								highlight.style.left = '2px';
								highlight.style.width = '32px';
							} else if (index === 1) {
								highlight.style.left = '34px';
								highlight.style.width = '32px';
							} else {
								highlight.style.left = '66px';
								highlight.style.width = 'calc(100% - 68px)';
							}
						}
					} else {
						btn.classList.remove('active');
					}
				});
			}

			// Update icon based on current mode
			function updateIcon() {
				const mode = getCurrentMode();
				let icon;

				if (mode === 'dark') {
					icon = 'fa-moon';
				} else if (mode === 'light') {
					icon = 'fa-sun';
				} else {
					icon = 'fa-display'; // system mode
				}

				if (themeIcon) {
					themeIcon.className = `fa-solid ${icon}`;
				}
				if (themeIconMobile) {
					themeIconMobile.className = `fa-solid ${icon}`;
				}
			}

			// Send theme to iframe
			function sendThemeToIframe(theme) {
				const iframe = document.querySelector('.assistant-iframe');
				if (iframe && iframe.contentWindow) {
					iframe.contentWindow.postMessage({ type: 'theme-change', theme }, '*');
				}
			}

			// Apply theme to document
			function applyTheme() {
				const displayTheme = getDisplayTheme();
				html.setAttribute('data-theme', displayTheme);
				// Send theme to iframe
				sendThemeToIframe(displayTheme);
			}

			// Toggle theme: dark -> light -> system -> dark
			function toggleTheme() {
				const currentMode = getCurrentMode();
				let newMode;

				if (currentMode === 'dark') {
					newMode = 'light';
				} else if (currentMode === 'light') {
					newMode = 'system';
				} else {
					newMode = 'dark';
				}

				localStorage.setItem('theme', newMode);
				applyTheme();
				updateIcon();
				updateFooterToggle();
			}

			// Set specific theme (for footer toggle)
			function setTheme(newMode) {
				localStorage.setItem('theme', newMode);
				applyTheme();
				updateIcon();
				updateFooterToggle();
			}

			// Set up event listeners
			if (themeToggle) {
				themeToggle.addEventListener('click', toggleTheme);
			}
			if (themeToggleMobile) {
				themeToggleMobile.addEventListener('click', toggleTheme);
			}

			// Set up footer toggle listeners
			if (footerThemeToggle) {
				const buttons = footerThemeToggle.querySelectorAll('.theme-option');
				buttons.forEach(btn => {
					btn.addEventListener('click', (e) => {
						e.stopPropagation();
						const mode = btn.getAttribute('data-theme');
						setTheme(mode);
					});
				});
			}

			// Listen for system theme changes when in system mode
			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
				if (getCurrentMode() === 'system') {
					applyTheme();
					updateFooterToggle();
				}
			});

			// Initialize
			applyTheme();
			updateIcon();
			updateFooterToggle();
		});
	</script>

	<!-- Console Easter Egg -->
	<script is:inline>
		console.log("Hello. Appreciate you being here. — Luke");
	</script>
</body>
</html>
